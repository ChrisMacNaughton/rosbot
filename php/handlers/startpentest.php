<?php

define('INFRACODE', '/opt/rosbot/infracode');

require_once(INFRACODE . '/php/common-includes.php');
require_once(INFRACODE . '/php/log.php');
require_once(INFRACODE . '/php/start.php');

$projectName = $argv[1];
if (isset($argv[2]) && strlen($argv[2]) > 0)
{
    $basedOn = $argv[2];
}
else
{
    $basedOn = null;
}

$log = new \Monolog\Logger('rosbot-startpentest');
$formatter = new \Monolog\Formatter\LineFormatter("> %message%\n");

$echo = new \Monolog\Handler\ErrorLogHandler();
$echo->setLevel(\Monolog\Logger::INFO);
$echo->setFormatter($formatter);
$log->pushHandler($echo);

// TODO: use FingersCrossedHandler or similar to show debug messages in case of failure.
$errorlog = new RocketChatHandler('ros-errorlog', \Monolog\Logger::ERROR);
$errorlog->setFormatter($formatter);
$log->pushHandler(new \Monolog\Handler\BufferHandler($errorlog));

GlobalLog::$log = $log;

try
{
    startproject(Triad::PEN, $projectName, $basedOn);
}
catch (Exception $e)
{
    $log->error('Starting new project failed: ' . $e->getMessage());
}



?>
